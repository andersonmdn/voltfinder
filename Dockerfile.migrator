FROM node:20-alpine

# Instalar dependências necessárias para Prisma
RUN apk add --no-cache openssl

# Ativa o pnpm via Corepack como root (tem permissão para /usr/local/bin)
RUN corepack enable && corepack prepare pnpm@8.10.0 --activate

# Criar diretórios necessários com permissões corretas
RUN mkdir -p /home/node/.pnpm-store /repo && chown -R node:node /home/node/.pnpm-store /repo

WORKDIR /repo/apps/api
